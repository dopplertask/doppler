<html xmlns:v="urn:schemas-microsoft-com:vml" xmlns:o="urn:schemas-microsoft-com:office:office">
<head>
    <title></title>
    <meta name="apple-mobile-web-app-capable" content="yes"/>
    <meta name="viewport" content="width=device-width, minimum-scale=1.0"/>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <link type="text/css" rel="stylesheet" href="css/aristo/jquery-ui-1.8.16.custom.css"/>
    <link type="text/css" rel="stylesheet" href="css/jquery.layout.css"/>
    <link type="text/css" rel="stylesheet" href="css/application.css"/>
    <script src="lib/jquery.js"></script>
    <script src="lib/jquery-ui.js"></script>
    <script src="lib/jquery.browser.js"></script>
    <script src="lib/jquery.layout.js"></script>

    <script src="draw2d.js"></script>
    <script src="StartFigure.js"></script>
    <script src="BetweenFigure.js"></script>
    <script src="BetweenMultiOutputFigure.js"></script>
    <script src="MyInterceptorPolicy.js"></script>
    <script src="gui/Application.js"></script>
    <script src="gui/View.js"></script>
    <script src="gui/Toolbar.js"></script>
    <script src="gui/HoverConnection.js"></script>

    <script type="text/javascript">

        var createConnection = function (sourcePort, targetPort) {

            var conn = new draw2d.Connection({
                                                 router: new draw2d.layout.connection.InteractiveManhattanConnectionRouter(),
                                                 stroke: 2,
                                                 color: "#00ff17",
                                                 radius: 20,
                                                 outlineColor: "#30ff30",
                                                 source: sourcePort,
                                                 target: targetPort,
                                                 stroke: 2
                                             });

            console.log("Source PORT: " + conn.getSource());
            console.log("Target PORT: " + conn.getTarget());

            return conn;

        };

        let app;
        document.addEventListener("DOMContentLoaded", function () {

            // Everything is loaded - core and application. Now can create the
            // application
            //

            app = new example.Application();

            app.view.installEditPolicy(new draw2d.policy.connection.DragConnectionCreatePolicy({
                                                                                                   createConnection: createConnection
                                                                                               }));

            // Create two standard nodes for "start" and "end" and link
            // this figures with a standard Connector
            //
            /*	  var start  = new draw2d.shape.node.Start({x:130,y:130,width:60,height:60});
                  var end    = new draw2d.shape.node.End({x:450,y:250});

              var end2    = new draw2d.shape.node.Between({x:850,y:250});
                  canvas.add(start);
                  canvas.add(end);
              canvas.add(end2);*/
            // Add a connection via API calls between Start and Stop
            //
            /*	  var connection =createConnection(start.getOutputPort(0),end.getInputPort(0));
                  canvas.add(connection);*/

            // Add my implemention of a "Between" figure for the smart insert feature
            // inspect the "Between.onDrop" method for more details

            app.view.add(new StartFigure({x: 550, y: 340, width: 80, height: 80, actionName: "Start"}))
            /////////////////////////////////////////////////////////////////////
            // JUST ADD SOME DOCU ELEMENTS ON THE SCREEN
            /////////////////////////////////////////////////////////////////////

        });

        function displayJSON(canvas) {
            let writer = new draw2d.io.json.Writer();
            let outputBody = {actions: [], connections: []};
            writer.marshal(canvas, function (json) {
                for (var i = 0; i < json.length; i++) {
                    if (json[i].type == "draw2d.shape.node.Start") {
                        let currentActionPorts = [];
                        for (let j = 0; j < json[i].ports.length; j++) {
                            let decidedPortType = json[i].ports[j].type == "draw2d.OutputPort" ? "OUTPUT" : "INPUT";
                            currentActionPorts.push({externalId: json[i].ports[j].name, portType: decidedPortType})
                        }

                        outputBody.actions.push({"@type": "StartAction", ports: currentActionPorts});
                    }
                    if (json[i].type == "draw2d.shape.node.Between") {
                        let currentActionPorts = [];
                        for (let j = 0; j < json[i].ports.length; j++) {
                            let decidedPortType = json[i].ports[j].type == "draw2d.OutputPort" ? "OUTPUT" : "INPUT";
                            currentActionPorts.push({externalId: json[i].ports[j].name, portType: decidedPortType})
                        }

                        outputBody.actions.push({"@type": json[i].userData.action, ports: currentActionPorts});
                    }
                    if (json[i].type == "draw2d.Connection") {
                        outputBody.connections.push(
                            {source: {externalId: json[i].source.port}, target: {externalId: json[i].target.port}});
                    }
                }
                $("#json").text(JSON.stringify(outputBody, null, 2));
            });
        }

        function addNodeToApp() {
            app.view.add(new BetweenMultiOutputFigure({x: 550, y: 340, width: 80, height: 80}))
        }

        function editModelForFigure() {
            let currentSelection = app.view.selection.all.data[0];

            $('#exampleModal').modal('show');
            $('#exampleModalLabel').html("Edit action: " + currentSelection.userData.action);
        }


    </script>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
          integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"
            integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>
</head>


<body id="container">

<div id="content">
    <div id="toolbar"></div>
    <div id="canvas" class="" style="width:3000px; height:3000px;"></div>
</div>

<div id="navigation" class="">
    <div data-shape="StartFigure" class="palette_node_element draw2d_droppable">Start</div>
    <div data-shape="BetweenFigure" class="palette_node_element draw2d_droppable">End</div>
    <div class="palette_node_element" onclick="addNodeToApp()">Between</div>

    <!-- Button trigger modal -->
    <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#exampleModal">
        Launch demo modal
    </button>


    <div id="json"></div>
</div>
<!-- Modal -->
<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Modal title</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary">Save changes</button>
            </div>
        </div>
    </div>
</div>
</body>
</html>
